"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});function P(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var O={exports:{}},r=O.exports={},c,u;function b(){throw new Error("setTimeout has not been defined")}function E(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?c=setTimeout:c=b}catch{c=b}try{typeof clearTimeout=="function"?u=clearTimeout:u=E}catch{u=E}})();function S(e){if(c===setTimeout)return setTimeout(e,0);if((c===b||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch{try{return c.call(null,e,0)}catch{return c.call(this,e,0)}}}function R(e){if(u===clearTimeout)return clearTimeout(e);if((u===E||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch{try{return u.call(null,e)}catch{return u.call(this,e)}}}var l=[],N=!1,g,y=-1;function D(){!N||!g||(N=!1,g.length?l=g.concat(l):y=-1,l.length&&U())}function U(){if(!N){var e=S(D);N=!0;for(var t=l.length;t;){for(g=l,l=[];++y<t;)g&&g[y].run();y=-1,t=l.length}g=null,N=!1,R(e)}}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];l.push(new A(e,t)),l.length===1&&!N&&S(U)};function A(e,t){this.fun=e,this.array=t}A.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=!0;r.env={};r.argv=[];r.version="";r.versions={};function f(){}r.on=f;r.addListener=f;r.once=f;r.off=f;r.removeListener=f;r.removeAllListeners=f;r.emit=f;r.prependListener=f;r.prependOnceListener=f;r.listeners=function(e){return[]};r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0};var Y=O.exports;const h=P(Y),_=(e={})=>({region:e.region||h.env.BUNNY_REGION||"SG",baseHostName:"storage.bunnycdn.com",folderName:e.folderName||h.env.BUNNY_FOLDER_NAME||"",storageZone:e.storageZone||h.env.BUNNY_STORAGE_ZONE||"unset",password:e.password||h.env.BUNNY_PASSWORD||"unset"}),F=({storageZone:e,password:t,region:s,folderName:i})=>{e&&(h.env.BUNNY_STORAGE_ZONE=e),t&&(h.env.BUNNY_PASSWORD=t),s&&(h.env.BUNNY_REGION=s),i&&(h.env.BUNNY_FOLDER_NAME=i)},L=async({file:e,buffer:t,folder:s,...i})=>new Promise(async(n,a)=>{try{!t&&!e&&a({res:!1,message:"No file uploaded"});const o=_(i),p=t?t.length:e.buffer.length,m=o.folderName?`${o.folderName}/`:"",w=s?`${s}/`:"",d=`${new Date().getTime()}.webp`,$={method:"PUT",hostname:o.region?`${o.region}.${o.baseHostName}`:o.baseHostName,port:443,path:`/${o.storageZone}/${m}${w}${d}`,headers:{AccessKey:o.password,"Content-Type":"application/octet-stream","Content-Length":p.toString()}},T=await fetch(`https://${$.hostname}${$.path}`,{method:"PUT",headers:$.headers,body:t||e.buffer});if(T.status===201){const v=`https://${o.storageZone}.b-cdn.net/${m}${w}${d}`;n({res:!0,message:"upload success",url:v})}else a({res:!1,message:"Upload failed",error:await T.text()})}catch{a({res:!1,message:"Server error"})}}),B=async({folder:e="",configOverrides:t={}}={})=>new Promise((s,i)=>{try{const n=_(t),a=n.region?`${n.region}.${n.baseHostName}`:n.baseHostName,o=n.folderName?`${n.folderName}/`:"",p=e?`${e}/`:"",m=`https://${a}/${n.storageZone}/${o}${p}`,w={AccessKey:n.password};fetch(m,{headers:w}).then(d=>d.json()).then(d=>{const $=d.map(T=>{const v=`https://${n.storageZone}.b-cdn.net/${o}${p}${T.ObjectName}`;return{...T,Url:v}});s({res:!0,message:"List retrieved successfully",files:$})}).catch(d=>{i({res:!1,message:"Network error",error:d})})}catch{i({res:!1,message:"Server error"})}}),C=({ObjectName:e,href:t,...s})=>new Promise((i,n)=>{if(!e&&!t){n({res:!1,message:"No file specified for deletion"});return}try{const a=_(s),o=a.region?`${a.region}.${a.baseHostName}`:a.baseHostName,p=t?decodeURIComponent(t.split("/")[t.split("/").length-1]):e;fetch(`https://${o}/${a.storageZone}/${a.folderName}/${p}`,{method:"DELETE",headers:{AccessKey:a.password}}).then(m=>{m.status===200?i({res:!0,message:"File deleted successfully"}):i({res:!1,message:"Failed to delete file"})}).catch(m=>{n({res:!1,message:"Network error",error:m})})}catch{n({res:!1,message:"Server error"})}}),Z={install:F,upload:L,list:B,deleteFile:C};exports.default=Z;exports.deleteFile=C;exports.install=F;exports.list=B;exports.upload=L;
